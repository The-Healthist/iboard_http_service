# ç‰ˆæœ¬ 1.1.0 æ›´æ–°æ–‡æ¡£

## ğŸ“‹ æ›´æ–°æ¦‚è¿°

æœ¬æ¬¡æ›´æ–°ä¸»è¦æ–°å¢äº†è®¾å¤‡è½®æ’­åˆ—è¡¨åŒæ­¥ç®¡ç†åŠŸèƒ½ã€ç³»ç»Ÿé…ç½®å­—æ®µæ‰©å±•ã€åº”ç”¨ç‰ˆæœ¬ç®¡ç†æ¥å£ç­‰æ ¸å¿ƒåŠŸèƒ½ï¼Œæå‡äº†ç³»ç»Ÿçš„è‡ªåŠ¨åŒ–ç¨‹åº¦å’Œç”¨æˆ·ä½“éªŒã€‚

---

## ğŸ†• æ–°å¢åŠŸèƒ½

### 1. ç³»ç»Ÿé…ç½®å­—æ®µæ‰©å±•

ä¸º `setting` è¡¨æ·»åŠ äº†å››ä¸ªæ–°çš„é…ç½®å­—æ®µï¼Œç”¨äºä¼˜åŒ–ç³»ç»Ÿæ’­æ”¾è¡Œä¸ºï¼š

| å­—æ®µå | ç±»å‹ | é»˜è®¤å€¼ | åŠŸèƒ½æè¿° |
|--------|------|--------|----------|
| `AppUpdateDuration` | `int` | 600ç§’ | åº”ç”¨æ›´æ–°æ—¶é—´é—´éš” |
| `PaymentTableOnePageDuration` | `int` | 5ç§’ | ç¼´è´¹è¡¨æ ¼å•é¡µåœç•™æ—¶é—´ |
| `NormalToAnnouncementCarouselDuration` | `int` | 10ç§’ | æ­£å¸¸æ’­æ”¾åˆ°å…¬å‘Šè½®æ’­åˆ‡æ¢æ—¶é—´ |
| `AnnouncementCarouselToFullAdsCarouselDuration` | `int` | 10ç§’ | å…¬å‘Šè½®æ’­åˆ°å…¨å±å¹¿å‘Šè½®æ’­åˆ‡æ¢æ—¶é—´ |

**æŠ€æœ¯ç‰¹ç‚¹**ï¼š
- æ‰€æœ‰å­—æ®µå‡ä¸º `int` ç±»å‹ï¼Œå•ä½ç»Ÿä¸€ä¸ºç§’
- é‡‡ç”¨é©¼å³°å‘½åæ³•ï¼Œç¬¦åˆ Go è¯­è¨€è§„èŒƒ
- è®¾ç½®åˆç†çš„é»˜è®¤å€¼ï¼Œç¡®ä¿ç³»ç»Ÿæ­£å¸¸è¿è¡Œ

---

### 2. è®¾å¤‡è½®æ’­åˆ—è¡¨ç®¡ç†æ¥å£

#### 2.1 ç®¡ç†å‘˜è½®æ’­ç®¡ç†æ¥å£

##### é¡¶éƒ¨å¹¿å‘Šè½®æ’­ç®¡ç†

**è·å–é¡¶éƒ¨å¹¿å‘Šè½®æ’­åˆ—è¡¨**
- **æ¥å£**: `GET /api/admin/device/carousel/top_advertisements`
- **æƒé™**: ç®¡ç†å‘˜ JWT
- **åŠŸèƒ½**: è·å–è®¾å¤‡çš„é¡¶éƒ¨å¹¿å‘Šè½®æ’­å®Œæ•´ä¿¡æ¯åˆ—è¡¨

**è¯·æ±‚å‚æ•°**:
```json
{
  "deviceID": 1
}
```

**æ›´æ–°é¡¶éƒ¨å¹¿å‘Šè½®æ’­é¡ºåº**
- **æ¥å£**: `PUT /api/admin/device/carousel/top_advertisements`
- **æƒé™**: ç®¡ç†å‘˜ JWT
- **åŠŸèƒ½**: æ›´æ–°è®¾å¤‡é¡¶éƒ¨å¹¿å‘Šè½®æ’­é¡ºåºï¼ˆå…¨é‡æ›¿æ¢ï¼‰

**è¯·æ±‚å‚æ•°**:
```json
{
  "deviceID": 1,
  "data": [
    {
      "id": 3,
      "title": "ä¿ƒé”€å¹¿å‘Š",
      "description": "é™æ—¶ä¼˜æƒ æ´»åŠ¨",
      "type": "image",
      "status": "active",
      "duration": 45,
      "priority": 90,
      "startTime": "2024-01-01T00:00:00Z",
      "endTime": "2024-12-31T23:59:59Z",
      "display": "top",
      "fileId": 3,
      "isPublic": true
    }
  ]
}
```

##### å…¨å±å¹¿å‘Šè½®æ’­ç®¡ç†

**è·å–å…¨å±å¹¿å‘Šè½®æ’­åˆ—è¡¨**
- **æ¥å£**: `GET /api/admin/device/carousel/full_advertisements`
- **æƒé™**: ç®¡ç†å‘˜ JWT
- **åŠŸèƒ½**: è·å–è®¾å¤‡çš„å…¨å±å¹¿å‘Šè½®æ’­å®Œæ•´ä¿¡æ¯åˆ—è¡¨

**æ›´æ–°å…¨å±å¹¿å‘Šè½®æ’­é¡ºåº**
- **æ¥å£**: `PUT /api/admin/device/carousel/full_advertisements`
- **æƒé™**: ç®¡ç†å‘˜ JWT
- **åŠŸèƒ½**: æ›´æ–°è®¾å¤‡å…¨å±å¹¿å‘Šè½®æ’­é¡ºåºï¼ˆå…¨é‡æ›¿æ¢ï¼‰

##### å…¬å‘Šè½®æ’­ç®¡ç†

**è·å–å…¬å‘Šè½®æ’­åˆ—è¡¨**
- **æ¥å£**: `GET /api/admin/device/carousel/notices`
- **æƒé™**: ç®¡ç†å‘˜ JWT
- **åŠŸèƒ½**: è·å–è®¾å¤‡çš„å…¬å‘Šè½®æ’­å®Œæ•´ä¿¡æ¯åˆ—è¡¨

**æ›´æ–°å…¬å‘Šè½®æ’­é¡ºåº**
- **æ¥å£**: `PUT /api/admin/device/carousel/notices`
- **æƒé™**: ç®¡ç†å‘˜ JWT
- **åŠŸèƒ½**: æ›´æ–°è®¾å¤‡å…¬å‘Šè½®æ’­é¡ºåºï¼ˆå…¨é‡æ›¿æ¢ï¼‰

#### 2.2 è®¾å¤‡ç«¯è½®æ’­è·å–æ¥å£

| æ¥å£è·¯å¾„ | æ–¹æ³• | æƒé™ | åŠŸèƒ½æè¿° |
|----------|------|------|----------|
| `/api/device/client/carousel/top_advertisements` | GET | è®¾å¤‡ JWT | è·å–é¡¶éƒ¨å¹¿å‘Šè½®æ’­åˆ—è¡¨ |
| `/api/device/client/carousel/full_advertisements` | GET | è®¾å¤‡ JWT | è·å–å…¨å±å¹¿å‘Šè½®æ’­åˆ—è¡¨ |
| `/api/device/client/carousel/notices` | GET | è®¾å¤‡ JWT | è·å–å…¬å‘Šè½®æ’­åˆ—è¡¨ |

**å“åº”æ•°æ®ç‰¹ç‚¹**ï¼š
- è¿”å›å®Œæ•´çš„æ•°æ®ç»“æ„ä¿¡æ¯
- æŒ‰è‡ªå®šä¹‰é¡ºåºæ’åˆ—
- åŒ…å«å…³è”çš„æ–‡ä»¶ä¿¡æ¯

---

### 3. åº”ç”¨ç‰ˆæœ¬ç®¡ç†æ¥å£

#### 3.1 å…¬å¼€ç‰ˆæœ¬è·å–æ¥å£
- **æ¥å£**: `GET /api/app/version`
- **æƒé™**: å…¬å¼€è®¿é—®
- **åŠŸèƒ½**: è·å–å½“å‰åº”ç”¨ç‰ˆæœ¬é…ç½®ä¿¡æ¯ï¼ŒåŒ…å«å½“å‰ä½¿ç”¨çš„ç‰ˆæœ¬è¯¦æƒ…

**å“åº”æ•°æ®**:
```json
{
  "data": {
    "id": 1,
    "currentVersionId": 2,
    "currentVersion": {
      "id": 2,
      "versionNumber": "1.1.0",
      "buildNumber": "002",
      "description": "ä¿®å¤å·²çŸ¥é—®é¢˜ï¼Œä¼˜åŒ–ç”¨æˆ·ä½“éªŒ",
      "downloadUrl": "https://example.com/downloads/app-v1.1.0.apk",
      "status": "active"
    },
    "lastCheckTime": "2024-01-20T10:00:00Z",
    "updateInterval": 3600,
    "autoUpdate": false,
    "status": "active",
    "createdAt": "2024-01-01T00:00:00Z",
    "updatedAt": "2024-01-20T10:00:00Z"
  },
  "message": "Get app version config success"
}
```

#### 3.2 åº”ç”¨ç‰ˆæœ¬é…ç½®æ›´æ–°æ¥å£
- **æ¥å£**: `PUT /api/admin/app/version`
- **æƒé™**: ç®¡ç†å‘˜ JWT
- **åŠŸèƒ½**: æ›´æ–°åº”ç”¨ç‰ˆæœ¬é…ç½®ï¼ŒåŒ…æ‹¬è®¾ç½®å½“å‰ä½¿ç”¨çš„ç‰ˆæœ¬

**è¯·æ±‚å‚æ•°ç¤ºä¾‹**:
```json
{
  "id": 1,
  "currentVersionId": 2,
  "updateInterval": 7200,
  "autoUpdate": true,
  "status": "active"
}
```

**å“åº”æ•°æ®**:
```json
{
  "message": "update app version config success",
  "data": {
    "id": 1,
    "currentVersionId": 2,
    "currentVersion": {
      "id": 2,
      "versionNumber": "1.1.0",
      "buildNumber": "002",
      "description": "ä¿®å¤å·²çŸ¥é—®é¢˜ï¼Œä¼˜åŒ–ç”¨æˆ·ä½“éªŒ",
      "downloadUrl": "https://example.com/downloads/app-v1.1.0.apk",
      "status": "active"
    },
    "lastCheckTime": "2024-01-20T10:00:00Z",
    "updateInterval": 7200,
    "autoUpdate": true,
    "status": "active",
    "createdAt": "2024-01-01T00:00:00Z",
    "updatedAt": "2024-01-20T10:00:00Z"
  }
}
```

---

### 4. ç‰ˆæœ¬ç®¡ç†æ¥å£ï¼ˆç®¡ç†å‘˜ï¼‰

#### 4.1 ç‰ˆæœ¬ CRUD æ“ä½œ

**åˆ›å»ºç‰ˆæœ¬**
- **æ¥å£**: `POST /api/admin/version`
- **æƒé™**: ç®¡ç†å‘˜ JWT
- **åŠŸèƒ½**: åˆ›å»ºæ–°çš„åº”ç”¨ç‰ˆæœ¬

**è¯·æ±‚å‚æ•°ç¤ºä¾‹**:
```json
{
  "versionNumber": "1.1.1",
  "buildNumber": "002",
  "description": "æ–°å¢åŠŸèƒ½ç‰¹æ€§ï¼Œæå‡ç”¨æˆ·ä½“éªŒ",
  "downloadUrl": "https://example.com/downloads/app-v1.1.1.apk",
  "status": "active"
}
```

**è·å–ç‰ˆæœ¬åˆ—è¡¨**
- **æ¥å£**: `GET /api/admin/versions`
- **æƒé™**: ç®¡ç†å‘˜ JWT
- **åŠŸèƒ½**: è·å–æ‰€æœ‰ç‰ˆæœ¬ä¿¡æ¯åˆ—è¡¨

**è·å–å•ä¸ªç‰ˆæœ¬**
- **æ¥å£**: `GET /api/admin/version/:id`
- **æƒé™**: ç®¡ç†å‘˜ JWT
- **åŠŸèƒ½**: æ ¹æ®IDè·å–ç‰¹å®šç‰ˆæœ¬ä¿¡æ¯

**æ›´æ–°ç‰ˆæœ¬**
- **æ¥å£**: `PUT /api/admin/version`
- **æƒé™**: ç®¡ç†å‘˜ JWT
- **åŠŸèƒ½**: æ›´æ–°ç‰ˆæœ¬ä¿¡æ¯

**åˆ é™¤ç‰ˆæœ¬**
- **æ¥å£**: `DELETE /api/admin/version/:id`
- **æƒé™**: ç®¡ç†å‘˜ JWT
- **åŠŸèƒ½**: åˆ é™¤æŒ‡å®šç‰ˆæœ¬ï¼ˆä¸èƒ½åˆ é™¤å½“å‰ä½¿ç”¨çš„ç‰ˆæœ¬ï¼‰

**è·å–æ´»è·ƒç‰ˆæœ¬**
- **æ¥å£**: `GET /api/admin/versions/active`
- **æƒé™**: ç®¡ç†å‘˜ JWT
- **åŠŸèƒ½**: è·å–æ‰€æœ‰çŠ¶æ€ä¸ºæ´»è·ƒçš„ç‰ˆæœ¬åˆ—è¡¨

---

### 5. æ•°æ®æ¨¡å‹è¯´æ˜

#### 5.1 App æ¨¡å‹ï¼ˆåº”ç”¨é…ç½®ï¼‰
```go
type App struct {
    ID              uint      `json:"id"`
    CurrentVersionID uint     `json:"currentVersionId"` // å½“å‰ä½¿ç”¨çš„ç‰ˆæœ¬ID
    CurrentVersion   *Version  `json:"currentVersion"`   // å½“å‰ç‰ˆæœ¬ä¿¡æ¯ï¼ˆå…³è”æŸ¥è¯¢ï¼‰
    LastCheckTime    time.Time `json:"lastCheckTime"`    // æœ€åæ£€æŸ¥æ›´æ–°æ—¶é—´
    UpdateInterval   int       `json:"updateInterval"`   // æ£€æŸ¥æ›´æ–°é—´éš”(ç§’)
    AutoUpdate       bool      `json:"autoUpdate"`       // æ˜¯å¦è‡ªåŠ¨æ›´æ–°
    Status           string    `json:"status"`           // åº”ç”¨çŠ¶æ€
    CreatedAt        time.Time `json:"createdAt"`
    UpdatedAt        time.Time `json:"updatedAt"`
}
```

#### 5.2 Version æ¨¡å‹ï¼ˆç‰ˆæœ¬ä¿¡æ¯ï¼‰
```go
type Version struct {
    ID                    uint      `json:"id"`
    VersionNumber         string    `json:"versionNumber"`         // ç‰ˆæœ¬å·
    BuildNumber           string    `json:"buildNumber"`           // æ„å»ºå·
    Description           string    `json:"description"`           // ç‰ˆæœ¬æè¿°
    DownloadUrl           string    `json:"downloadUrl"`           // ä¸‹è½½åœ°å€
    Status                string    `json:"status"`                // çŠ¶æ€:active,inactive,deprecated
    CreatedAt             time.Time `json:"createdAt"`
    UpdatedAt             time.Time `json:"updatedAt"`
}
```

---

### 6. æ¥å£è®¾è®¡ç‰¹ç‚¹

#### 6.1 å…¬å¼€æ¥å£
- **`GET /api/app/version`**: å®¢æˆ·ç«¯è·å–å½“å‰ç‰ˆæœ¬ä¿¡æ¯å’Œä¸‹è½½åœ°å€
- æ— éœ€è®¤è¯ï¼Œæ”¯æŒæ‰€æœ‰ç”¨æˆ·è®¿é—®
- è¿”å›å®Œæ•´çš„ç‰ˆæœ¬é…ç½®å’Œå½“å‰ç‰ˆæœ¬è¯¦æƒ…

#### 6.2 ç®¡ç†å‘˜æ¥å£
- **`PUT /api/admin/app/version`**: ç®¡ç†å‘˜æ›´æ–°åº”ç”¨é…ç½®
- **ç‰ˆæœ¬ç®¡ç†**: å®Œæ•´çš„ç‰ˆæœ¬ CRUD æ“ä½œ
- æ”¯æŒç‰ˆæœ¬åˆ‡æ¢ã€é…ç½®è°ƒæ•´ç­‰ç®¡ç†åŠŸèƒ½

#### 6.3 æ•°æ®å…³è”
- App æ¨¡å‹é€šè¿‡ `CurrentVersionID` å…³è”åˆ° Version æ¨¡å‹
- æ”¯æŒé¢„åŠ è½½æŸ¥è¯¢ï¼Œä¸€æ¬¡è¯·æ±‚è·å–å®Œæ•´ä¿¡æ¯
- ç¡®ä¿æ•°æ®ä¸€è‡´æ€§å’Œå®Œæ•´æ€§

